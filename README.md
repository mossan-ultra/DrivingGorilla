# DrivingGorilla

![DrivingGorilla_overview_image](/doc/DrivingGorilla_overview_image.png)

Movie：[DrivingGorillaが今スグわかる3分ショートムービー]()

Apps(PWA)：[https://front-inky-one.vercel.app/](https://front-inky-one.vercel.app/)<br>
GitHub：[https://github.com/mossan-ultra/DrivingGorilla](https://github.com/mossan-ultra/DrivingGorilla)
<br>
Astar zKatana：[ [Buddy](https://zkatana.blockscout.com/token/0xFe432277e48a30BC21FC32c3e3ab8b62C5EeB6a6) ] [ [Prison Break](https://zkatana.blockscout.com/token/0xb6E6C614530EFB517Ef3CAcCE089AC367F2CCf77) ]


![DrivingGorilla_overview_ScreenShot](/doc/DrivingGorilla_overview_ScreenShot.png)
「走る歓び」を進化させ続け、お客様の「生きる歓び」に繋げよう。
<p>「自分だけの相棒ゴリラと冒険（ドライブ）に出かけよう！」</p> 
相棒ゴリラはドライブ内容に応じて手に入るTokenで成長し、プレイヤーの相棒ゴリラ同士でバトルをしたりランキングを競い合える。
<br><br>

> 本アプリではweb3の特徴の一つである「分散化と信頼性」により、<br>
運転データをオンチェーン上に、改竄不可能な民主化された情報として記録できます。<br>
> 更に「ユーザーのデータ権利」として相棒ゴリラNFT、ご当地NFTをブロックチェーンのデータとして取り扱えるようになります。<br>
> あなたと相棒ゴリラとの冒険（ドライブ）の記録と思い出は、世代を超えてブロックチェーンに歴史として刻まれる。

# Problems

- 自動車業界は、生活者や世界のデジタル化から遅れている
- 移動体験の感動を妨げる課題も多い

# Objective

### Problems while driving and solutions with this app

| Problems | Details | solutions |
| :------: | :-------: | :-------: |
| 渋滞 | 渋滞の時間をどう楽しむか、そもそも渋滞を防げないのか | 渋滞中に周辺のご当地NFTや置きゴリとバトルしたりできる |
| 居眠り運転 | 居眠り運転をどう防ぐか、アラート以外で防げないのか | 相棒ゴリラとインタラクティブな会話により居眠り運転を抑止する |
| マンネリ化した移動体験 | 通勤・通学等の移動のマンネリ化を防げないか、より楽しいものに出来ないか | 安全運転、エコドライブでトークンが得られる、見たことのないご当地NFTや置きゴリとの出会い |
| 長距離移動 | 長距離移動の疲れを減らせないか長距離運転を無くせないのか | 運転時間、運転距離でもトークンが得られる |
| 退屈な道中 | 同乗者や子供がゲームや動画以外で、もっと楽しく暇つぶしできないか | 相棒ゴリラとインタラクティブな会話で盛り上がったり、手に入れたご当地NFTを眺めたりできる |

# Deriverables

### Drive to Earn

1. 安全運転、エコドライブ、運転時間、運転距離、給油回数によりトークンが得られます。
2. 相棒ゴリラを全世界の好きなエリアに置きゴリラとして配置する事でステーキングによる報酬トークンが得られます。

### Use for Fun!

1. 全国の相棒ゴリラホルダーと相棒ゴリラが手に入れたトークン量をランキングでリアルタイムに競い合える。
2. あなただけの相棒ゴリラと全国のユーザーが配置した置きゴリラでバトルする事ができる。
3. ドライブ中に手に入れる特別なご当地NFTを自慢できる。
4. 特別なご当地NFTを持っている人だけへの特典を提供。
（ディーラーでノベルティと引き換え、特別なDAOコミュニティへの参加など）

### Drive

1. 自分だけの相棒ゴリラNFTが得られる（生成AIにより自動生成したショートムービーのNFTアート）
2. 安全運転、エコドライブ、運転時間、運転距離、給油回数により経験値トークンが得られる
3. 特定のスポットにドライブで訪れる事によりインタラクティブで美しい特別な装備NFTを手に入れる事ができる
4. 自動車でのお出かけに限らず、Mobility全般、ウォーキング、ランニング、サイクリング、ツーリング、お買い物、タクシーのお供としても利用可能

### Entertainment

1. 自分だけの相棒ゴリラを安全運転やエコドライブなどで得られる経験値トークンや、ご当地NFTで成長させる事ができる
2. 全世界のユーザーの相棒ゴリラとランキングで競い合うことができる
3. 相棒ゴリラを全世界の好きなエリアに置きゴリラとして配置する事でステーキングすることができる
4. ドライブを通じて全世界の相棒ゴリラとバトルを楽しむことができる
5. 相棒ゴリラにはChatGPT、音声合成、音声認識を搭載しており、ドライブ中に音声で会話することができる
6. あなたの発話に対する相棒ゴリラの感情をAIによる感情分析でPositive、Natural、Negativeで表現します（感情表現により相棒ゴリラのアニメーションが変化します）
7. 今回の相棒ゴリラは神社巡りが大好きで、マスクメロンが大好物です。魔王も倒したことがあるようです。話しかけてみて下さい。

| Positive | Natural | Negative |
| :------: | :-------: | :-------: |
| ![Positive Gorilla](/front/public/gif/Chatbot_PositiveImage.gif) | ![Neutral Gorilla](/front/public/gif/Chatbot_NeutralImagen.gif) | ![Negative Gorilla](/front/public/gif/Chatbot_NegativeImage.gif) |

# Success Criteria

| Goal Name | Success Criteria | reason | 
| :------: | :-------: | :-------: | 
| 相棒ゴリラNFT数 | 100,00 以上 | 通常アプリのコンセプト検証成功基準として設定する一般的な指針のため |
| 経験値トークンmint量 | 50,0000,000以上 | 日常の通常利用時にmintされる想定のトークン量のため |
| 平均レビュー点数 | 4.0以上 | 5段階の満足度評価を設定した場合、カスタマーサクセスの検証成功基準として設定する一般的な指針のため |

# Requirements

- ネットワークチェーンは「Astar zKEVM」テストネットのzKatanaを採用（ガス代低減による運用費節減）
- UI/UX向上を目的にweb3Authでの認証可能とし、Account Abstractionに対応（ガスレス）
- 運転データをオンチェーン上に保存し、データに応じた経験値トークンをmint<br>
mint条件=安全運転、エコドライブ、運転時間、運転距離、給油回数
- PWA化により特定のOSやデバイスに依存せず、PC、スマートフォン、タブレットなど、どの端末でもアプリを楽しめる
- 自分だけのインタラクティブな相棒ゴリラ(NFTアニメーションアート)を貰える
- ChatGPTを搭載した相棒ゴリラと音声対話チャットで繋がりのある会話のキャッチボールが可能
- 全世界の地図上の好きな場所に相棒ゴリラの分身を置きゴリとして配置可能
- 置きゴリにはステーキング機能を実装（但し、一定確率で脱獄し消滅）
- 特定のスポットにチェックインすることでご当地装備NFTを入手する事ができる
- 経験値トークンと装備NFTで相棒ゴリラが強くなりステータスとランキングを確認できる

# System Architecture
![DrivingGorilla_overview_ScreenShot](/doc/architecture.png)

※web3トランザクションのシーケンスは[ContractのREADME](/contract/README.md)を参照

# Architecture Decision Record

| Architecture | Decision Record |  
| :------: | :-------: |  
| Astar zKEVM | Astarを応援したい気持ち！！Layer2のチーム内PoCも | 
| Gelato | zKatanaでAAを行う選択肢は現状Gelatoのみと判断（BiconomyがzKatanaなら試してみたかった…） | 
| web3Auth | ソーシャルログインを入り口にウォレットを作成することでユーザーのUXを向上 | 
| Progressive Web Apps | 特定のOSやデバイスに依存せず開発、運用などのコストを低減が可能 | 
| Azure OpenAI | 安全性の高い他の多彩な他のAIサービスとの併用、クラウドベースによるスムーズな導入と優れたコスト管理 | 
| gpt-35-turbo-16k | 一度に日本語だと約8000文字を処理可能、且つgpt-4と比較するとコストを大幅に低減可能 | 
| Azure AI Speech-Sdk | 高品質な多国語の音声合成、音声認識が可能（今回はja-jpで最適化） |
| Azure AI Language-Text | OpenAI、Speech-Sdkと併用が容易且つ、多国語の対応が可能 |
| Stable Diffusion Web UI | 高品質なアニメーション動画を短期間で製作可能 |

# Deck

![DrivingGorilla_overview_ScreenShot](/doc/DrivingGorilla_overview_ScreenShot.png)

## Sign in
サインイン画面です。サインインを行うとWeb3Authの認証画面が表示され、認証することで画面遷移します。

相棒ゴリラを持っていない場合→初回画面

相棒ゴリラを持っている場合→Home画面

<img width="375" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/81e1b0dd-ac15-407e-8622-5b895ed4bc8a">

## 初回画面
相棒ゴリラを持っていない時に表示される画面です。

相棒ゴリラを生成することができます。

<img width="377" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/4cce1bb7-5b2f-4ef1-a2b2-676ac763d085">

## Home
Homeでは相棒ゴリラとトークすることができます。

マイクアイコンをタップ後話しかけることで音声で返信してくれます。

| 相棒 | チャットログ |
| :------: | :-------: |
| <img width="376" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/1835726c-aa44-42f8-87d3-b89eb455c1b4">| <img width="377" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/a1e097c1-ecd1-430d-b392-6fb0f1a42d84">

## Status
ステータス表示は相棒ゴリラのステータスと装備NFTの総和が表示されます。

また、ステータスランキングを確認することができます。

<img width="374" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/d6b514c6-1637-441e-9798-fcdc6699b6cd">

## Equipment
獲得した装備を確認する画面です。

<img width="374" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/11116ff3-dd4f-40a4-99ec-f47c343ee0f9">

## Drive
現在位置がマップ上にプロットされます。

マイクアイコンをタップ後話しかけることで音声で返信してくれます。

右下のチェックインボタンを押すとチェックインすることができ、特定ポイントであれば装備NFTがミントされます。

| Drive画面 | 装備NFTミント画面 |
| :------: | :-------: |
| <img width="375" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/a80e0077-0bab-41d9-ba1a-fbb4b2cb4fa3">| <img width="375" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/d0749787-d6d5-4dea-a3a9-abb5c6a5fb25">

## Collection
おきゴリの作成、表示、ゴリラバトルを行う画面です。

おきゴリは相棒ゴリラのトークンを分け与えることで作成できます。

作成時に期間設定が可能で、期間を満了すると預けたトークン＋αを持って帰ってきます。

ただし、一定確率で脱走することがあり、脱走した場合預けたトークンは無くなります。

| Collection画面 | おきゴリバトル | おきゴリ作成　|
| :------: | :-------: | :-------: |
| <img width="374" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/0ffad9a4-ecc8-430e-9fc7-5822ecb18702">　| <img width="376" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/5dd472c5-6128-4580-99e4-d997ed6d2a6c"> | <img width="375" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/bf54748e-f089-402f-8622-5c69141d2a0e">

## 運転データの登録
アプリを起動すると一日一回運転データを登録する画面が表示されます。

この画面では運転データを登録することで前日の運転成績に応じたトークン（経験値）が払い出されます。

また、おきゴリの期間が満了していた場合、おきゴリ結果を確認することができます。

| 運転データ登録 | 経験値獲得 |脱走ゴリラ |帰ってきたゴリラ |
| :------: | :-------: |:-------: |:-------: |
| <img width="376" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/ddde29f8-fa08-45bf-9f84-b4b4e7cb404c">| <img width="377" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/53e14283-e858-4713-8217-d9b0ec691b11">|<img width="375" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/e82473a5-7ec0-496c-bfa0-9eda215d87f2">|<img width="376" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/b25fee16-927b-4c7d-a45c-1e4ed720c0f5">

# 今後実現できるユーザー体験

1. ドライブデータの利活用のために、分散型ドライバーコミュニティ、分散型広告プラットフォームに繋げて活かす事ができる。<br>
2. 自分だけの相棒ゴリラのアニメーションをmint時に自動生成して、よりユニークな相棒ゴリラにできる。<br>
3. 相棒ゴリラの特徴や自車位置、走行データをChatGPTのpromptとして、よりインタラクティブな会話をする事ができる。<br>
4. 相棒ゴリラの応答感情（Positive、Natural、Negative）をオンチェーンのデータとして残し、過去のドライブシーンの思い出と重ねて振り返る事ができる。<br>
5. WebGLでビジュアライズしているご当地NFTについて、メタデータにビジュライズに必要な情報を持たせてビジュアライズしたり、レアリティを付加できる。<br>
6. 走行データの形跡や運転者の目の動きをディープラーニング（画像認識、物体検知など）を活用して、居眠り運転の可能性を検知した時に相棒ゴリラの音声合成をトリガーして運転者に話しかける。<br>
7. 特別なフレーズ（「hey!Gorilla」など）を頭に挟む事で相棒ゴリラと完全ハンズフリー通話を実現する。<br>
8. 相棒ゴリラに尋ねると近くのご当地NFTや置きゴリの場所まで音声ナビゲーションしてくれる。<br>
9. 各国向けのローカライズと多言語対応する事で海外旅行、海外出張時も楽しむ事ができるようにできる。（現在も相棒ゴリラにNativeな英語で話しかけると英語で返してくれる事もあります）<br>
10. ご当地とコラボレーションして特別なご当地NFTを発行して特定のお店でクーポンとして活用できるようにしたり、広告収入を得たりする。<br>

# Getting Started

<p>ここからは本アプリをローカルPC上で試験動作させるための手順の説明になります</p>

>※デモアプリを試したい場合は 
[コチラ](https://front-inky-one.vercel.app/) 
から試す事もできます</p>

# Things to install in advance

Please install the following tools in advance.<br>
- [node(v18 LTS)](https://nodejs.org/en/download)<br>
- [git](https://git-scm.com/downloads)<br>


## Contractをデプロイします

[ContractのREADME](/contract/README.md)を参照してContractをデプロイします

## 環境変数を設定します

.env.localファイルを作成し以下の環境変数を設定します
```bash
NEXT_PUBLIC_GOOGLE_MAP_APIKEY={Google Map APIキー}
NEXT_PUBLIC_OPENAI_API_KEY={Azure OpenAI APIキー}
NEXT_PUBLIC_OPENAI_API_VERSION={Azure OpenAI APIバージョン}（例：2023-08-01-preview）
NEXT_PUBLIC_OPENAI_RESOURCE={Azure OpenAI リソース名}
NEXT_PUBLIC_OPENAI_DEPLOYMENT={Azure OpenAI モデルデプロイ名}
NEXT_PUBLIC_SPEECH_SDK_KEY={Azure AI Speech SDKキー}
NEXT_PUBLIC_SPEECHSDK_REGION={Azure AI Speech SDKリージョン}
NEXT_PUBLIC_TEXT_ANALYSIS_KEY={Azure AI TextAnalysisキー}
NEXT_PUBLIC_TEXT_ANALYSIS_ENDPOINT={Azure AI TextAnalysisエンドポイント}
NEXT_PUBLIC_GELATO_RELAY_API_KEY={Gelato　Relay APIキー}
NEXT_PUBLIC_WEB3AUTH_CLIENT_ID={Web3Auth Client ID}
```

### Google Map APIキーを準備します

ドライブマップを利用するにはGoogle MapのAPIキーが必要です。<br>
[Maps JavaScript API](https://developers.google.com/maps/documentation/javascript?hl=ja)の手順に沿ってGoogle MapのAPIキーを準備します。<br>
※Maps JavaScript API のご利用にあたっては、請求先アカウントと Maps JavaScript API が有効なプロジェクトが必要です。
詳しくは、[Cloud コンソール](https://developers.google.com/maps/documentation/javascript/cloud-setup?hl=ja)での設定をご覧ください。

### Gelatoを設定します
https://beta.app.gelato.network/relay へ行き、API Keyを作成します。<br>
本プロダクトでは1Blanceによりガス代を支払いますのでデポジットしておいてください。

参考：https://github.com/gelatodigital/astar-zkatana-starter-kit

```
NEXT_PUBLIC_GELATO_RELAY_API_KEY={Gelato API Key}
```

### web3Authを設定します
https://web3auth.io/ へ行き、プロジェクトを作成します。<br>
作成後、プロジェクトの設定画面からClientIdをコピーし、envへ貼り付けます。
```
NEXT_PUBLIC_WEB3AUTH_CLIENT_ID={web3Auth API Key}
```

### AzureのSubscriptionを準備します

[Azure の無料アカウントを使ってクラウドで構築](https://azure.microsoft.com/ja-jp/free/)から無料のAzureアカウントを作成して有効なSubscriptionを準備します。
Azureを開始するにはMicrosoftのアカウントが必要です。<br>
まだ作成していない場合は[アカウントの作成](https://signup.live.com/signup?)よりアカウントを作成します。

### Azure Open AIのリソースを準備します

[Azure OpenAI Service](https://learn.microsoft.com/ja-jp/azure/ai-services/openai/how-to/create-resource?pivots=web-portal) のリソースを作成してデプロイする<br>
※2023/11/25現在 Azure OpenAI サービスは[登録](https://customervoice.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR7en2Ais5pxKtso_Pz4b1_xUNTZBNzRKNlVQSFhZMU9aV09EVzYxWFdORCQlQCN0PWcu)が必要で、現在は承認された企業顧客およびパートナーのみが利用できます。<br>
※個人メールアドレス（Example: @gmail.com, @yahoo.com, @hotmail.com, etc.）での申請は拒否されるようです。詳しくは[コチラ](https://learn.microsoft.com/ja-jp/legal/cognitive-services/openai/limited-access?context=%2Fazure%2Fcognitive-services%2Fopenai%2Fcontext%2Fcontext)をご確認ください。

デプロイしたAzure Open AIリソースを開き{Azure OpenAI リソース名}を確認します

![Azure Open AIリソース](/doc/AzureOpenAI_Resource.png)

デプロイしたAzure OpenAIリソースの「キーとエンドポイント」を開き{Azure OpenAI APIキー}を.env.localファイルの所定のキー値とします<br>

![Azure OpenAIリソースの「キーとエンドポイント」](/doc/AzureOpenAI_Key.png)

次に「モデルのデプロイ」- 「展開の管理」より「
[Azure OpenAI Studio](https://oai.azure.com/portal/)
」を開きます</p>

### 続いて作成したAzure OpenAIリソースの展開の管理からモデルをデプロイします

![Azure Open AIリソースのモデルのデプロイ](/doc/AzureOpenAI_ModelDeployOpen.png)

Azure Open AI Studioが開きます。「デプロイ」-「＋新しいデプロイの作成」を開きます

![Azure AI |Azure Open AI Studio](/doc/AzureAIStudio.png)

「モデルのデプロイ」の「モデルを選択してください」のプルダウンよりモデルを選択します。<br>
※本アプリでは「gpt-35-turbo-16k」を選択します。モデルの詳細は
[Azure OpenAI Service モデル](https://learn.microsoft.com/ja-jp/azure/ai-services/openai/concepts/models)
で確認できます。

![モデルを選択してください](/doc/AzureAIStudio_ModelSelect.png)

続いて「デプロイ名」を入力します。ここで入力する「デプロイ名」は環境変数の{Azure OpenAI モデルデプロイ名}として使用します。他の項目は初期値でOKです。

![Azure OpenAI モデルデプロイ名](/doc/AzureAIStudio_ModelDeploy.png)

※ここで設定したモデルのデプロイ名は「Azure Open AIのリソースの情報」として後で使用します<br>
準備した「Azure Open AIのリソースの情報」を.env.localファイルの所定のキー値とします

```bash
NEXT_PUBLIC_OPENAI_API_KEY={Azure OpenAI APIキー}
NEXT_PUBLIC_OPENAI_API_VERSION={Azure OpenAI APIバージョン}
NEXT_PUBLIC_OPENAI_RESOURCE={Azure OpenAI リソース名}
NEXT_PUBLIC_OPENAI_DEPLOYMENT={Azure OpenAI モデルデプロイ名}
```
[公式ドキュメント](https://learn.microsoft.com/ja-jp/azure/ai-services/openai/reference)の「サポートされているバージョン」の日付部分（例：2023-08-01-preview）をバージョン情報として使います<br>

### Azure AI Speech Serviceのリソースを準備します

[Azure AI Speech Service](https://learn.microsoft.com/ja-jp/azure/ai-services/speech-service/speech-studio-overview)のリソースをデプロイします。<br>
- [Azure AI Speech Studio](https://speech.microsoft.com/portal?)

デプロイしたAzure AI Speech Serviceの「キーとエンドポイント」を開き{Azure AI Speech SDKキー}と{Azure AI Speech SDKリージョン}を.env.localファイルの所定のキー値とします<br>

![Azure AI Speech Serviceの「キーとエンドポイント」](/doc/AzureSpeech_Key.png)

```bash
NEXT_PUBLIC_SPEECH_SDK_KEY={Azure AI Speech SDKキー}
NEXT_PUBLIC_SPEECHSDK_REGION={Azure AI Speech SDKリージョン}
```

### Azure AI Language Serviceのリソースを準備します

[Azure AI Language Service](https://learn.microsoft.com/ja-jp/azure/ai-services/language-service/language-studiobr)のリソースをデプロイします<br>

- [Azure AI Language Studio](https://language.cognitive.azure.com/home)

デプロイしたAzure AI Language Serviceの「キーとエンドポイント」を開き{Azure AI TextAnalysisキー}と{Azure AI TextAnalysisエンドポイント}を.env.localファイルの所定のキー値とします<br>

![Azure AI Language Serviceの「キーとエンドポイント」](/doc/AzureLanguage_Key.png)

```bash
NEXT_PUBLIC_TEXT_ANALYSIS_KEY={Azure AI TextAnalysisキー}
NEXT_PUBLIC_TEXT_ANALYSIS_ENDPOINT={Azure AI TextAnalysisエンドポイント}
```

## Quickstart

Githubより[本アプリのgitリポジトリ](https://github.com/mossan-ultra/DrivingGorilla)をcloneします
```bash
git clone git@github.com:mossan-ultra/DrivingGorilla.git
```

カレントディレクトを./frontに変更してアプリを開始します
```bash
cd ./front
npx run build
npx next dev
```
起動するとTerminalに以下のように出力されます<br>
![Terminal](/doc/Terminal.png)

コンソールのURL([http://localhost:3000](http://localhost:3000))をクリックするかブラウザのアドレス欄に以下を貼り付けて実行します
```
http://localhost:3000
```

サインイン画面が表示されれば完了です

<img width="375" alt="image" src="https://github.com/mossan-ultra/DrivingGorilla/assets/95908731/81e1b0dd-ac15-407e-8622-5b895ed4bc8a">
